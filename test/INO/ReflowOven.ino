



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1" media="(device-height: 568px)">
  <meta http-equiv="Content-Language" content="en">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <meta name="browser-stats-url" content="https://api.github.com/_private/browser/stats">
  <meta name="theme-color" content="#f5f5f5">

      <meta name="google-analytics" content="UA-3769691-2">

<meta content="collector.githubapp.com" name="octolytics-host" /><meta content="github" name="octolytics-app-id" /><meta content="D5E955F3:6E9D:420FBB4:578C9623" name="octolytics-dimension-request_id" />
<meta content="mobile" name="octolytics-dimension-device" />
<meta content="2344352" name="octolytics-dimension-user_id" /><meta content="markpudd" name="octolytics-dimension-user_login" /><meta content="24345810" name="octolytics-dimension-repository_id" /><meta content="markpudd/reflow_oven" name="octolytics-dimension-repository_nwo" /><meta content="true" name="octolytics-dimension-repository_public" /><meta content="false" name="octolytics-dimension-repository_is_fork" /><meta content="24345810" name="octolytics-dimension-repository_network_root_id" /><meta content="markpudd/reflow_oven" name="octolytics-dimension-repository_network_root_nwo" />

<meta content="/&lt;user-name&gt;/&lt;repo-name&gt;/blob/show" data-pjax-transient="true" name="analytics-location" />



  <meta class="js-ga-set" name="dimension1" content="Logged Out">
    <meta class="js-ga-set" name="dimension3" content="mobile">




  <title>GitHub · Where software is built</title>

  <link crossorigin="anonymous" href="https://assets-cdn.github.com/assets/mobile-b20219adbc6e573c639831720dffdeabf4911e4175e222fc9959954fc027ea50.css" integrity="sha256-sgIZrbxuVzxjmDFyDf/eq/SRHkF14iL8mVmVT8An6lA=" media="all" rel="stylesheet" />
  <link crossorigin="anonymous" href="https://assets-cdn.github.com/assets/system-fonts-d60dee4b68e3a38b01c0389551a0e38f04acd897ec85592f405d045ee853b3d1.css" integrity="sha256-1g3uS2jjo4sBwDiVUaDjjwSs2JfshVkvQF0EXuhTs9E=" media="all" rel="stylesheet" />
</head>
<body class="">
  <header class="nav-bar">
    <div class="nav-bar-inner ">
      <button class="header-button header-nav-button touchable js-show-global-nav" data-ga-click="Mobile, tap, location:header; text:Hamburger">
        <svg aria-hidden="true" class="octicon octicon-three-bars" height="24" version="1.1" viewBox="0 0 12 16" width="18"><path d="M11.41 9H.59C0 9 0 8.59 0 8c0-.59 0-1 .59-1H11.4c.59 0 .59.41.59 1 0 .59 0 1-.59 1h.01zm0-4H.59C0 5 0 4.59 0 4c0-.59 0-1 .59-1H11.4c.59 0 .59.41.59 1 0 .59 0 1-.59 1h.01zM.59 11H11.4c.59 0 .59.41.59 1 0 .59 0 1-.59 1H.59C0 13 0 12.59 0 12c0-.59 0-1 .59-1z"></path></svg>
      </button>

      <div class="nav-bar-title-text">
              <svg aria-hidden="true" class="octicon octicon-repo" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M4 9H3V8h1v1zm0-3H3v1h1V6zm0-2H3v1h1V4zm0-2H3v1h1V2zm8-1v12c0 .55-.45 1-1 1H6v2l-1.5-1.5L3 16v-2H1c-.55 0-1-.45-1-1V1c0-.55.45-1 1-1h10c.55 0 1 .45 1 1zm-1 10H1v2h2v-1h3v1h5v-2zm0-10H2v9h9V1z"></path></svg>

    <strong><a href="/markpudd">markpudd</a></strong>
    /
    <strong><a href="/markpudd/reflow_oven">reflow_oven</a></strong>

      </div>

      

    </div>


    <nav class="nav-bar-tabs repo-nav-bar-tabs">
      <ul>
          <li>
            <a href="/explore" data-ga-click="Mobile, tap, location:header; text:Explore">
              <svg aria-hidden="true" class="octicon octicon-telescope" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path d="M8 9l3 6h-1l-2-4v5H7v-6l-2 5H4l2-5 2-1zM7 0H6v1h1V0zM5 3H4v1h1V3zM2 1H1v1h1V1zM.63 9a.52.52 0 0 0-.16.67l.55.92c.13.23.41.31.64.2l1.39-.66-1.16-2-1.27.86.01.01zm7.89-5.39l-5.8 3.95L3.95 9.7l6.33-3.03-1.77-3.06h.01zm4.22 1.28l-1.47-2.52a.51.51 0 0 0-.72-.17l-1.2.83 1.84 3.2 1.33-.64c.27-.13.36-.44.22-.7z"></path></svg>
              Explore
            </a>
          </li>
        <li>
            <a href="/login?return_to=%2Fmarkpudd%2Freflow_oven%2Fblob%2Fmaster%2FReflowOven.ino" data-ga-click="Mobile, tap, location:header; text:Sign in">
              <svg aria-hidden="true" class="octicon octicon-sign-in" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path d="M7 6.75V12h4V8h1v4c0 .55-.45 1-1 1H7v3l-5.45-2.72c-.33-.17-.55-.52-.55-.91V1c0-.55.45-1 1-1h9c.55 0 1 .45 1 1v3h-1V1H3l4 2v2.25L10 3v2h4v2h-4v2L7 6.75z"></path></svg>
              Sign in
            </a>
        </li>
            <li class="section-title">This repository</li>
    <li><a href="/markpudd/reflow_oven?files=1"><svg aria-hidden="true" class="octicon octicon-code" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path d="M9.5 3L8 4.5 11.5 8 8 11.5 9.5 13 14 8 9.5 3zm-5 0L0 8l4.5 5L6 11.5 2.5 8 6 4.5 4.5 3z"></path></svg> Code</a></li>
      <li><a href="/markpudd/reflow_oven/issues"><svg aria-hidden="true" class="octicon octicon-issue-opened" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg> Issues</a></li>
    <li><a href="/markpudd/reflow_oven/pulls"><svg aria-hidden="true" class="octicon octicon-git-pull-request" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z"></path></svg> Pull Requests</a></li>
    <li><a href="/markpudd/reflow_oven/pulse"><svg aria-hidden="true" class="octicon octicon-pulse" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path d="M11.5 8L8.8 5.4 6.6 8.5 5.5 1.6 2.38 8H0v2h3.6l.9-1.8.9 5.4L9 8.5l1.6 1.5H14V8z"></path></svg> Pulse</a></li>

      </ul>
    </nav>
  </header>


  <div id="js-flash-container">
</div>


        

<div class="breadcrumb blob-breadcrumb">
  <label for="blob-history-checkbox" class="blob-history-label">
    <svg aria-hidden="true" class="octicon octicon-history" height="16" version="1.1" viewBox="0 0 14 16" width="14"><path d="M8 13H6V6h5v2H8v5zM7 1C4.81 1 2.87 2.02 1.59 3.59L0 2v4h4L2.5 4.5C3.55 3.17 5.17 2.3 7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-.34.03-.67.09-1H.08C.03 7.33 0 7.66 0 8c0 3.86 3.14 7 7 7s7-3.14 7-7-3.14-7-7-7z"></path></svg>
  </label>
  <span class="filetype-icon"><svg aria-hidden="true" class="octicon octicon-file-text" height="16" version="1.1" viewBox="0 0 12 16" width="12"><path d="M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .55-.45 1-1 1H1c-.55 0-1-.45-1-1V2c0-.55.45-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z"></path></svg></span>
  <strong class="final-path">ReflowOven.ino</strong>
</div>

<input id="blob-history-checkbox"
       class="js-blob-history-checkbox blob-history-checkbox"
       type="checkbox"
       data-url="/markpudd/reflow_oven/latest_commit/master/ReflowOven.ino">

<div class="blob-history">
  <a href="/markpudd/reflow_oven/commits/master/ReflowOven.ino" class="js-blob-history-link">
    Loading latest commit…
</a></div>

  <div class="blob-file-content js-file-line-container">
    <div class="highlighted-blob tab-size" data-tab-size="8"><div class="code-body highlight"><pre><div class='line js-file-line' id='LC1'>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&quot;</span>U8glib.h<span class="pl-pds">&quot;</span></span></div><div class='line js-file-line' id='LC2'>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>SPI.h<span class="pl-pds">&gt;</span></span></div><div class='line js-file-line' id='LC3'><br></div><div class='line js-file-line' id='LC4'><span class="pl-k">int</span> profile1Time[<span class="pl-c1">6</span>] = {<span class="pl-c1">0</span>,<span class="pl-c1">60</span>,<span class="pl-c1">150</span>,<span class="pl-c1">180</span>,<span class="pl-c1">240</span>,<span class="pl-c1">300</span>};</div><div class='line js-file-line' id='LC5'><span class="pl-k">int</span> profile1Temp[<span class="pl-c1">6</span>] = {<span class="pl-c1">0</span>,<span class="pl-c1">150</span>,<span class="pl-c1">175</span>,<span class="pl-c1">220</span>,<span class="pl-c1">30</span>,<span class="pl-c1">0</span>};</div><div class='line js-file-line' id='LC6'><br></div><div class='line js-file-line' id='LC7'><br></div><div class='line js-file-line' id='LC8'><span class="pl-k">const</span> <span class="pl-k">int</span> TEMP_MAX = <span class="pl-c1">250</span>;</div><div class='line js-file-line' id='LC9'><br></div><div class='line js-file-line' id='LC10'><span class="pl-k">const</span> <span class="pl-k">int</span> GRAPH_WIDTH_PX=<span class="pl-c1">128</span>;</div><div class='line js-file-line' id='LC11'><span class="pl-k">const</span> <span class="pl-k">int</span> GRAPH_HEIGHT_PX=<span class="pl-c1">54</span>;</div><div class='line js-file-line' id='LC12'><br></div><div class='line js-file-line' id='LC13'><span class="pl-k">const</span> <span class="pl-k">int</span> DISPLAY_WIDTH_PX=<span class="pl-c1">128</span>;</div><div class='line js-file-line' id='LC14'><span class="pl-k">const</span> <span class="pl-k">int</span> DISPLAY_HEIGHT_PX=<span class="pl-c1">64</span>;</div><div class='line js-file-line' id='LC15'><br></div><div class='line js-file-line' id='LC16'><span class="pl-k">const</span> <span class="pl-k">int</span> HEATER_RELAY_PIN = <span class="pl-c1">6</span>;</div><div class='line js-file-line' id='LC17'><span class="pl-k">const</span> <span class="pl-k">int</span> START_STOP_PIN = <span class="pl-c1">7</span>;</div><div class='line js-file-line' id='LC18'><span class="pl-k">const</span> <span class="pl-k">int</span> SELECT_PIN = <span class="pl-c1">8</span>;</div><div class='line js-file-line' id='LC19'><span class="pl-k">const</span> <span class="pl-k">int</span> OTHER_PIN = <span class="pl-c1">9</span>;</div><div class='line js-file-line' id='LC20'><br></div><div class='line js-file-line' id='LC21'><span class="pl-k">int</span> buttonStates[<span class="pl-c1">3</span>] = {<span class="pl-c1">1</span>,<span class="pl-c1">1</span>,<span class="pl-c1">1</span>};</div><div class='line js-file-line' id='LC22'><br></div><div class='line js-file-line' id='LC23'><span class="pl-k">const</span> <span class="pl-k">int</span> START_BUTTON = <span class="pl-c1">0</span>;     </div><div class='line js-file-line' id='LC24'><span class="pl-k">const</span> <span class="pl-k">int</span> SELECT_BUTTON = <span class="pl-c1">1</span>;     </div><div class='line js-file-line' id='LC25'><span class="pl-k">const</span> <span class="pl-k">int</span> OTHER_BUTTON = <span class="pl-c1">2</span>;     </div><div class='line js-file-line' id='LC26'>&nbsp;&nbsp;</div><div class='line js-file-line' id='LC27'><span class="pl-k">const</span> <span class="pl-k">int</span> DATA_OUT=<span class="pl-c1">11</span>; <span class="pl-c">//MOSI</span></div><div class='line js-file-line' id='LC28'><span class="pl-k">const</span> <span class="pl-k">int</span> DATA_IN=<span class="pl-c1">12</span>; <span class="pl-c">//MISO </span></div><div class='line js-file-line' id='LC29'><span class="pl-k">const</span> <span class="pl-k">int</span> SPI_CLOCK=<span class="pl-c1">13</span>; <span class="pl-c">//sck</span></div><div class='line js-file-line' id='LC30'><span class="pl-k">const</span> <span class="pl-k">int</span> HEAT_SEL=<span class="pl-c1">10</span>; <span class="pl-c">//sck</span></div><div class='line js-file-line' id='LC31'><br></div><div class='line js-file-line' id='LC32'><span class="pl-k">int</span> timePos;</div><div class='line js-file-line' id='LC33'><span class="pl-k">int</span> screenMode;</div><div class='line js-file-line' id='LC34'>boolean inCycle;</div><div class='line js-file-line' id='LC35'><span class="pl-k">int</span> targetTemp;</div><div class='line js-file-line' id='LC36'><span class="pl-c">// stats</span></div><div class='line js-file-line' id='LC37'><br></div><div class='line js-file-line' id='LC38'><span class="pl-k">int</span> overRuns;</div><div class='line js-file-line' id='LC39'><span class="pl-k">int</span> underRuns;</div><div class='line js-file-line' id='LC40'><span class="pl-k">float</span> maxOver;</div><div class='line js-file-line' id='LC41'><span class="pl-k">float</span> maxUnder;</div><div class='line js-file-line' id='LC42'><span class="pl-k">float</span> averageDeviation;</div><div class='line js-file-line' id='LC43'><br></div><div class='line js-file-line' id='LC44'>U8GLIB_SSD1306_128X64 <span class="pl-en">u8g</span>(U8G_I2C_OPT_NONE);</div><div class='line js-file-line' id='LC45'><br></div><div class='line js-file-line' id='LC46'><br></div><div class='line js-file-line' id='LC47'><span class="pl-k">char</span> textBuf[<span class="pl-c1">20</span>];</div><div class='line js-file-line' id='LC48'><br></div><div class='line js-file-line' id='LC49'><span class="pl-k">void</span> <span class="pl-en">setup</span>() {</div><div class='line js-file-line' id='LC50'>&nbsp;&nbsp;&nbsp;&nbsp;inCycle=<span class="pl-c1">false</span>;</div><div class='line js-file-line' id='LC51'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-c1">pinMode</span>(HEATER_RELAY_PIN, OUTPUT); </div><div class='line js-file-line' id='LC52'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-c1">digitalWrite</span>(HEATER_RELAY_PIN, LOW);	</div><div class='line js-file-line' id='LC53'><br></div><div class='line js-file-line' id='LC54'>&nbsp;&nbsp;&nbsp;&nbsp;u8g.<span class="pl-c1">setFont</span>(u8g_font_unifont);</div><div class='line js-file-line' id='LC55'><br></div><div class='line js-file-line' id='LC56'>&nbsp;&nbsp;&nbsp;&nbsp;screenMode = <span class="pl-c1">0</span>;</div><div class='line js-file-line' id='LC57'><br></div><div class='line js-file-line' id='LC58'><br></div><div class='line js-file-line' id='LC59'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-c1">pinMode</span>(START_STOP_PIN, INPUT_PULLUP); </div><div class='line js-file-line' id='LC60'><br></div><div class='line js-file-line' id='LC61'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-c1">pinMode</span>(SELECT_PIN, INPUT_PULLUP); </div><div class='line js-file-line' id='LC62'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-c1">pinMode</span>(OTHER_PIN, INPUT_PULLUP); </div><div class='line js-file-line' id='LC63'><br></div><div class='line js-file-line' id='LC64'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-c">// SPI initialization</span></div><div class='line js-file-line' id='LC65'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-c1">pinMode</span>(DATA_OUT, OUTPUT);</div><div class='line js-file-line' id='LC66'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-c1">pinMode</span>(DATA_IN, INPUT);</div><div class='line js-file-line' id='LC67'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-c1">pinMode</span>(SPI_CLOCK,OUTPUT);</div><div class='line js-file-line' id='LC68'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-c1">pinMode</span>(HEAT_SEL, OUTPUT);  </div><div class='line js-file-line' id='LC69'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-c1">digitalWrite</span>(HEAT_SEL, HIGH);  </div><div class='line js-file-line' id='LC70'>&nbsp;&nbsp;&nbsp;&nbsp;SPI.<span class="pl-c1">begin</span>(); </div><div class='line js-file-line' id='LC71'>&nbsp;&nbsp;&nbsp;&nbsp;SPI.<span class="pl-c1">setClockDivider</span>(SPI_CLOCK_DIV64); </div><div class='line js-file-line' id='LC72'>&nbsp;&nbsp;&nbsp;&nbsp;SPI.<span class="pl-c1">setBitOrder</span>(MSBFIRST);</div><div class='line js-file-line' id='LC73'>&nbsp;&nbsp;&nbsp;&nbsp;SPI.<span class="pl-c1">setDataMode</span>(SPI_MODE1);</div><div class='line js-file-line' id='LC74'>&nbsp;&nbsp;&nbsp;&nbsp;Serial.<span class="pl-c1">begin</span>(<span class="pl-c1">57600</span>);</div><div class='line js-file-line' id='LC75'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-c1">delay</span>(<span class="pl-c1">10</span>);  </div><div class='line js-file-line' id='LC76'>&nbsp;&nbsp;</div><div class='line js-file-line' id='LC77'>&nbsp;&nbsp;</div><div class='line js-file-line' id='LC78'>&nbsp;&nbsp;&nbsp;&nbsp;Serial.<span class="pl-c1">begin</span>(<span class="pl-c1">57600</span>);</div><div class='line js-file-line' id='LC79'>}</div><div class='line js-file-line' id='LC80'><br></div><div class='line js-file-line' id='LC81'><span class="pl-k">int</span> <span class="pl-en">readCelsius</span>() {</div><div class='line js-file-line' id='LC82'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-k">unsigned</span> <span class="pl-k">int</span> b1;</div><div class='line js-file-line' id='LC83'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-k">unsigned</span> <span class="pl-k">int</span> b2;</div><div class='line js-file-line' id='LC84'>&nbsp;</div><div class='line js-file-line' id='LC85'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-c1">digitalWrite</span>(HEAT_SEL, LOW); </div><div class='line js-file-line' id='LC86'>&nbsp;&nbsp;&nbsp;&nbsp;b1 = SPI.<span class="pl-c1">transfer</span>(0x00);</div><div class='line js-file-line' id='LC87'>&nbsp;&nbsp;&nbsp;&nbsp;b2 = SPI.<span class="pl-c1">transfer</span>(0x00);</div><div class='line js-file-line' id='LC88'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-c1">digitalWrite</span>(HEAT_SEL, HIGH); </div><div class='line js-file-line' id='LC89'><br></div><div class='line js-file-line' id='LC90'>&nbsp;&nbsp;&nbsp;&nbsp;b1 = b1 &lt;&lt; <span class="pl-c1">8</span>;</div><div class='line js-file-line' id='LC91'>&nbsp;&nbsp;&nbsp;&nbsp;b1 = b2 | b1;</div><div class='line js-file-line' id='LC92'>&nbsp;&nbsp;&nbsp;&nbsp;b1 = b1 &gt;&gt; <span class="pl-c1">3</span>;</div><div class='line js-file-line' id='LC93'><br></div><div class='line js-file-line' id='LC94'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-k">return</span> b1 &gt;&gt; <span class="pl-c1">2</span>;</div><div class='line js-file-line' id='LC95'>}</div><div class='line js-file-line' id='LC96'><br></div><div class='line js-file-line' id='LC97'><br></div><div class='line js-file-line' id='LC98'><span class="pl-k">void</span> <span class="pl-en">loop</span>() {</div><div class='line js-file-line' id='LC99'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-k">unsigned</span> <span class="pl-k">long</span> currentMillis = <span class="pl-c1">millis</span>();</div><div class='line js-file-line' id='LC100'>	<span class="pl-k">int</span> * profileTime = profile1Time;</div><div class='line js-file-line' id='LC101'>	<span class="pl-k">int</span> * profileTemp = profile1Temp;</div><div class='line js-file-line' id='LC102'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-c1">updateScreen</span>(profileTime,profileTemp);</div><div class='line js-file-line' id='LC103'>	<span class="pl-k">if</span>(inCycle) {</div><div class='line js-file-line' id='LC104'>		<span class="pl-c1">updateHeater</span>(profileTime,profileTemp);</div><div class='line js-file-line' id='LC105'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	timePos++;</div><div class='line js-file-line' id='LC106'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<span class="pl-k">if</span>(timePos &gt;= profileTime[<span class="pl-c1">5</span>]*<span class="pl-c1">5</span>) {</div><div class='line js-file-line' id='LC107'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Serial.<span class="pl-c1">println</span>(profileTime[<span class="pl-c1">5</span>]);</div><div class='line js-file-line' id='LC108'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;		<span class="pl-c1">stop</span>();</div><div class='line js-file-line' id='LC109'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	}</div><div class='line js-file-line' id='LC110'>	} <span class="pl-k">else</span> { </div><div class='line js-file-line' id='LC111'>		<span class="pl-c1">digitalWrite</span>(HEATER_RELAY_PIN, LOW);	</div><div class='line js-file-line' id='LC112'>	}</div><div class='line js-file-line' id='LC113'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-c">//  Serial.println(millis()-currentMillis);</span></div><div class='line js-file-line' id='LC114'>	<span class="pl-c1">checkButtons</span>();</div><div class='line js-file-line' id='LC115'>	<span class="pl-c1">delay</span>(<span class="pl-c1">250</span>-(<span class="pl-c1">millis</span>()-currentMillis));</div><div class='line js-file-line' id='LC116'><br></div><div class='line js-file-line' id='LC117'>}</div><div class='line js-file-line' id='LC118'><br></div><div class='line js-file-line' id='LC119'><span class="pl-k">void</span> <span class="pl-en">start</span>() {</div><div class='line js-file-line' id='LC120'>	targetTemp =<span class="pl-c1">0</span>;</div><div class='line js-file-line' id='LC121'>	timePos = <span class="pl-c1">0</span>;</div><div class='line js-file-line' id='LC122'>	screenMode = <span class="pl-c1">1</span>;</div><div class='line js-file-line' id='LC123'>	inCycle = <span class="pl-c1">true</span>;</div><div class='line js-file-line' id='LC124'>}</div><div class='line js-file-line' id='LC125'><br></div><div class='line js-file-line' id='LC126'><span class="pl-k">void</span> <span class="pl-en">stop</span>() {</div><div class='line js-file-line' id='LC127'>	timePos = <span class="pl-c1">0</span>;</div><div class='line js-file-line' id='LC128'>	screenMode = <span class="pl-c1">0</span>;</div><div class='line js-file-line' id='LC129'>	inCycle = <span class="pl-c1">false</span>;</div><div class='line js-file-line' id='LC130'>	<span class="pl-c1">digitalWrite</span>(HEATER_RELAY_PIN, LOW);	</div><div class='line js-file-line' id='LC131'>}</div><div class='line js-file-line' id='LC132'><br></div><div class='line js-file-line' id='LC133'><br></div><div class='line js-file-line' id='LC134'><span class="pl-k">void</span> <span class="pl-en">checkButtons</span>() {</div><div class='line js-file-line' id='LC135'>	<span class="pl-k">int</span> newButtonStates[<span class="pl-c1">3</span>]; </div><div class='line js-file-line' id='LC136'>	boolean pressed[<span class="pl-c1">3</span>] ={<span class="pl-c1">false</span>,<span class="pl-c1">false</span>,<span class="pl-c1">false</span>}; </div><div class='line js-file-line' id='LC137'><br></div><div class='line js-file-line' id='LC138'>	newButtonStates[START_BUTTON] = <span class="pl-c1">digitalRead</span>(START_STOP_PIN);     </div><div class='line js-file-line' id='LC139'>	newButtonStates[SELECT_BUTTON] = <span class="pl-c1">digitalRead</span>(SELECT_PIN);     </div><div class='line js-file-line' id='LC140'>	newButtonStates[OTHER_BUTTON] = <span class="pl-c1">digitalRead</span>(OTHER_PIN);      </div><div class='line js-file-line' id='LC141'><br></div><div class='line js-file-line' id='LC142'>	<span class="pl-k">for</span>(<span class="pl-k">int</span> i=<span class="pl-c1">0</span>;i&lt;<span class="pl-c1">3</span>;i++) {</div><div class='line js-file-line' id='LC143'>	    <span class="pl-k">if</span> (newButtonStates[i] != buttonStates[i]) {</div><div class='line js-file-line' id='LC144'>	      <span class="pl-k">if</span> (newButtonStates[i] == LOW) {</div><div class='line js-file-line' id='LC145'>			  pressed[i] = <span class="pl-c1">true</span>;</div><div class='line js-file-line' id='LC146'>		  } <span class="pl-k">else</span> {</div><div class='line js-file-line' id='LC147'>		  	  pressed[i] = <span class="pl-c1">false</span>;</div><div class='line js-file-line' id='LC148'>		  }</div><div class='line js-file-line' id='LC149'>	  }</div><div class='line js-file-line' id='LC150'>	  buttonStates[i] = newButtonStates[i];	</div><div class='line js-file-line' id='LC151'>	}</div><div class='line js-file-line' id='LC152'>	<span class="pl-k">if</span>(pressed[START_BUTTON]) {</div><div class='line js-file-line' id='LC153'><br></div><div class='line js-file-line' id='LC154'>			<span class="pl-k">if</span>(!inCycle)</div><div class='line js-file-line' id='LC155'>				<span class="pl-c1">start</span>();</div><div class='line js-file-line' id='LC156'>			<span class="pl-k">else</span> {</div><div class='line js-file-line' id='LC157'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Serial.<span class="pl-c1">println</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>STOP<span class="pl-pds">&quot;</span></span>);</div><div class='line js-file-line' id='LC158'>				<span class="pl-c1">stop</span>();</div><div class='line js-file-line' id='LC159'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div><div class='line js-file-line' id='LC160'><br></div><div class='line js-file-line' id='LC161'>	} </div><div class='line js-file-line' id='LC162'><br></div><div class='line js-file-line' id='LC163'>}</div><div class='line js-file-line' id='LC164'>&nbsp;</div><div class='line js-file-line' id='LC165'><span class="pl-k">void</span> <span class="pl-en">updateHeater</span>(<span class="pl-k">int</span> *profileTimes, <span class="pl-k">int</span>* profileTemps) {</div><div class='line js-file-line' id='LC166'>	<span class="pl-k">int</span> currentSegment=<span class="pl-c1">0</span>;</div><div class='line js-file-line' id='LC167'>	<span class="pl-k">while</span> (currentSegment&lt;<span class="pl-c1">6</span>) {</div><div class='line js-file-line' id='LC168'>		<span class="pl-k">if</span>(profileTimes[currentSegment]&gt;(timePos/<span class="pl-c1">4</span>)) {</div><div class='line js-file-line' id='LC169'>			<span class="pl-k">break</span>;</div><div class='line js-file-line' id='LC170'>		}</div><div class='line js-file-line' id='LC171'>		currentSegment++;</div><div class='line js-file-line' id='LC172'>	}</div><div class='line js-file-line' id='LC173'>&nbsp;&nbsp;&nbsp;&nbsp;targetTemp =  <span class="pl-c1">map</span>(timePos/<span class="pl-c1">4</span>,profileTimes[currentSegment-<span class="pl-c1">1</span>],</div><div class='line js-file-line' id='LC174'>						  profileTimes[currentSegment],</div><div class='line js-file-line' id='LC175'>						  profileTemps[currentSegment-<span class="pl-c1">1</span>],</div><div class='line js-file-line' id='LC176'>						  profileTemps[currentSegment]);</div><div class='line js-file-line' id='LC177'><br></div><div class='line js-file-line' id='LC178'>	<span class="pl-k">if</span>(<span class="pl-c1">readCelsius</span>()&gt;targetTemp) {</div><div class='line js-file-line' id='LC179'>		<span class="pl-c1">digitalWrite</span>(HEATER_RELAY_PIN, LOW);	</div><div class='line js-file-line' id='LC180'>	} <span class="pl-k">else</span> {</div><div class='line js-file-line' id='LC181'>		<span class="pl-c1">digitalWrite</span>(HEATER_RELAY_PIN, HIGH);	</div><div class='line js-file-line' id='LC182'>	}</div><div class='line js-file-line' id='LC183'>}</div><div class='line js-file-line' id='LC184'><br></div><div class='line js-file-line' id='LC185'><span class="pl-k">void</span> <span class="pl-en">drawGraph</span>(<span class="pl-k">int</span> *profileTimes, <span class="pl-k">int</span>* profileTemps) {</div><div class='line js-file-line' id='LC186'>	<span class="pl-k">int</span> profileLen=profileTimes[<span class="pl-c1">5</span>];</div><div class='line js-file-line' id='LC187'>	<span class="pl-k">int</span> ppx;</div><div class='line js-file-line' id='LC188'>	<span class="pl-k">int</span> ppy;</div><div class='line js-file-line' id='LC189'><br></div><div class='line js-file-line' id='LC190'>	<span class="pl-c">//  Bunch of divide by 2 in here otherwise overflow.   bit shift may be slighty more efficent but less readable....</span></div><div class='line js-file-line' id='LC191'>	<span class="pl-k">for</span>(<span class="pl-k">int</span> i=<span class="pl-c1">0</span>;i&lt;<span class="pl-c1">6</span>;i++) {</div><div class='line js-file-line' id='LC192'>		<span class="pl-k">int</span> px = <span class="pl-c1">map</span>(profileTimes[i],<span class="pl-c1">0</span>,profileLen,<span class="pl-c1">0</span>,GRAPH_WIDTH_PX);</div><div class='line js-file-line' id='LC193'>		<span class="pl-k">int</span> py = DISPLAY_HEIGHT_PX - <span class="pl-c1">map</span>(profileTemps[i],<span class="pl-c1">0</span>,TEMP_MAX,<span class="pl-c1">0</span>,GRAPH_HEIGHT_PX);</div><div class='line js-file-line' id='LC194'>		<span class="pl-k">if</span>(i&gt;<span class="pl-c1">0</span>) {</div><div class='line js-file-line' id='LC195'>			u8g.<span class="pl-c1">drawLine</span>(ppx, ppy, px, py);</div><div class='line js-file-line' id='LC196'>		}</div><div class='line js-file-line' id='LC197'>		ppx=px;</div><div class='line js-file-line' id='LC198'>		ppy=py;</div><div class='line js-file-line' id='LC199'>	}</div><div class='line js-file-line' id='LC200'>}</div><div class='line js-file-line' id='LC201'><br></div><div class='line js-file-line' id='LC202'><span class="pl-k">void</span> <span class="pl-en">drawProgress</span>(<span class="pl-k">int</span> *profileTimes,<span class="pl-k">int</span> pos) {</div><div class='line js-file-line' id='LC203'>	<span class="pl-k">int</span> profileLen=profileTimes[<span class="pl-c1">5</span>];</div><div class='line js-file-line' id='LC204'>	<span class="pl-k">int</span> px = <span class="pl-c1">map</span>(pos,<span class="pl-c1">0</span>,profileLen,<span class="pl-c1">0</span>,GRAPH_WIDTH_PX);</div><div class='line js-file-line' id='LC205'>	u8g.<span class="pl-c1">drawLine</span>(px, DISPLAY_HEIGHT_PX, px, DISPLAY_HEIGHT_PX-GRAPH_HEIGHT_PX);</div><div class='line js-file-line' id='LC206'>}</div><div class='line js-file-line' id='LC207'><br></div><div class='line js-file-line' id='LC208'><span class="pl-k">void</span> <span class="pl-en">updateScreen</span>(<span class="pl-k">int</span> *profileTimes, <span class="pl-k">int</span>* profileTemps) {</div><div class='line js-file-line' id='LC209'>	<span class="pl-c">// profile select screen</span></div><div class='line js-file-line' id='LC210'>	<span class="pl-k">if</span>(screenMode==<span class="pl-c1">0</span>) {</div><div class='line js-file-line' id='LC211'>		u8g.<span class="pl-c1">drawStr</span>( <span class="pl-c1">0</span>, <span class="pl-c1">0</span>, <span class="pl-s"><span class="pl-pds">&quot;</span>Board Toaster<span class="pl-pds">&quot;</span></span>);</div><div class='line js-file-line' id='LC212'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-k">int</span> temp = <span class="pl-c1">readCelsius</span>();</div><div class='line js-file-line' id='LC213'>		String displayString = <span class="pl-c1">String</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>BTemp: <span class="pl-pds">&quot;</span></span>)+<span class="pl-c1">String</span>(temp);</div><div class='line js-file-line' id='LC214'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Serial.<span class="pl-c1">println</span>(displayString.<span class="pl-c1">c_str</span>());</div><div class='line js-file-line' id='LC215'>		 u8g.<span class="pl-c1">drawStr</span>( <span class="pl-c1">0</span>, <span class="pl-c1">20</span>, displayString.<span class="pl-c1">c_str</span>());</div><div class='line js-file-line' id='LC216'><br></div><div class='line js-file-line' id='LC217'>	}</div><div class='line js-file-line' id='LC218'>	<span class="pl-c">// Run screen 1</span></div><div class='line js-file-line' id='LC219'>	<span class="pl-k">if</span>(screenMode==<span class="pl-c1">1</span>) {</div><div class='line js-file-line' id='LC220'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="pl-k">int</span> temp = <span class="pl-c1">readCelsius</span>();</div><div class='line js-file-line' id='LC221'>		String displayString = <span class="pl-c1">String</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>Temp: <span class="pl-pds">&quot;</span></span>)+temp;</div><div class='line js-file-line' id='LC222'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;displayString=displayString+<span class="pl-c1">String</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>/<span class="pl-pds">&quot;</span></span>);</div><div class='line js-file-line' id='LC223'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;displayString=displayString+targetTemp;</div><div class='line js-file-line' id='LC224'>&nbsp;</div><div class='line js-file-line' id='LC225'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Serial.<span class="pl-c1">println</span>(displayString.<span class="pl-c1">c_str</span>());</div><div class='line js-file-line' id='LC226'>		u8g.<span class="pl-c1">drawStr</span>( <span class="pl-c1">0</span>, <span class="pl-c1">0</span>, displayString.<span class="pl-c1">c_str</span>());</div><div class='line js-file-line' id='LC227'>		<span class="pl-c1">drawGraph</span>(profileTimes,profileTemps);</div><div class='line js-file-line' id='LC228'>		<span class="pl-c1">drawProgress</span>(profileTimes,timePos/<span class="pl-c1">4</span>);</div><div class='line js-file-line' id='LC229'>	}</div><div class='line js-file-line' id='LC230'><br></div><div class='line js-file-line' id='LC231'><br></div><div class='line js-file-line' id='LC232'>}</div><div class='line js-file-line' id='LC233'><br></div></pre></div></div>
  </div>



  <footer class="clearfix">
    <div class="container">
      <a href="#"><svg aria-hidden="true" class="octicon octicon-mark-github" height="32" version="1.1" viewBox="0 0 16 16" width="32"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg></a>

      <ul class="clearfix">
        <li>
          <!-- </textarea> --><!-- '"` --><form accept-charset="UTF-8" action="/site/mobile_preference" class="js-mobile-preference-form" data-form-nonce="2d04b01867c1aa2c85abd6140df1c03d9f76be7d" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="494vuTf/wgo0/r/n8TmPYtNtK2qCr92N7va/cNLfTLcSX97vn7mJQbjDYQ2eWin4wO+OUbaVDy6K95tp7XbFag==" /></div>
            <input type="hidden" name="mobile" value="false">
            <input type="hidden" name="anchor" class="js-mobile-preference-anchor-field">

            <button type="submit" class="switch-to-desktop" data-ga-click="Mobile, switch to desktop, switch button">
              Desktop version
            </button>
</form>        </li>

      </ul>
    </div>
  </footer>
  
  <script async="async" crossorigin="anonymous" integrity="sha256-7778gXFq7fkap+3KLShsBSOcJ8TC6B40D4pdcJROw7Q=" src="https://assets-cdn.github.com/assets/mobile-efbefc81716aedf91aa7edca2d286c05239c27c4c2e81e340f8a5d70944ec3b4.js"></script>
</body>
</html>

